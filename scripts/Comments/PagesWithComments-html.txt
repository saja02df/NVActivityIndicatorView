<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"> 
<head>
<title>Pages with Comments</title>

<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:TemplateHidden msdt:dt="string">0</mso:TemplateHidden>
<mso:ManagedPropertyMapping msdt:dt="string">&#39;Link URL&#39;{Link URL}:&#39;Path&#39;,&#39;Title&#39;{Title}:&#39;Title&#39;,&#39;Body&#39;{Body}:&#39;Body&#39;,&#39;ID&#39;{ListItemID}:&#39;ListItemID&#39;, &#39;ListID&#39;{ListID}:&#39;ListID&#39;</mso:ManagedPropertyMapping>
<mso:MasterPageDescription msdt:dt="string">This Item Display Template will show a small thumbnail icon next to a hyperlink of the item title, with an additional line that is available for a custom managed property.</mso:MasterPageDescription>
<mso:ContentTypeId msdt:dt="string">0x0101002039C03B61C64EC4A04F5361F385106603</mso:ContentTypeId>
<mso:TargetControlType msdt:dt="string">;#Content Web Parts;#</mso:TargetControlType>
<mso:HtmlDesignAssociated msdt:dt="string">1</mso:HtmlDesignAssociated>
<mso:HtmlDesignStatusAndPreview msdt:dt="string">http://protososandbox.sqtdemo.com/sandbox/seom/_catalogs/masterpage/Display Templates/Content Web Parts/Item_PagesWithComments.html, Conversion successful.</mso:HtmlDesignStatusAndPreview>
<mso:HtmlDesignConversionSucceeded msdt:dt="string">True</mso:HtmlDesignConversionSucceeded>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>

    <script>
        $includeLanguageScript(this.url, "~sitecollection/_catalogs/masterpage/Display Templates/Language Files/{Locale}/CustomStrings.js");
    </script>

<div id="PagesWithComments">

<!--#_
var encodedId = $htmlEncode(ctx.ClientControl.get_nextUniqueId() + "_pageswithcomments_");

var linkURL = $getItemValue(ctx, "Link URL");
var title = $getItemValue(ctx, "Title");
var body = $getItemValue(ctx, "Body");

linkURL.overrideValueRenderer($urlHtmlEncode);
title.overrideValueRenderer($contentLineText);
body.overrideValueRenderer($contentLineText);

var bodySubString = body.toString().substring(0,300);
var listID = ctx.CurrentItem.ListID;
var listItemID = ctx.CurrentItem.ListItemID;

var elementID1 = listID.toString().substring(1, 37) + '_' + listItemID;

AddPostRenderCallback(ctx, function(){
	EnsureScriptFunc("sp.js", "SP.ClientContext", function () {
		
		var elementID = jQuery('#'+elementID1);
		ReadCounts(listItemID,elementID,linkURL);
		
	});
});

_#-->
        <div class="cbs-Item row" data-displaytemplate="pageswithcomments">
            <div class="news-inner row">
		<div class="news-wrapper">
			<a class="news-title" href="_#= linkURL =#_" title="_#= $htmlEncode(title.defaultValueRenderer(title)) =#_">_#= title =#_</a>
			<div class="news-body">_#= bodySubString =#_...</div>						
			<div class="comments" id="_#= elementID1 =#_">
				<div class="comments-count">
					<span class="comments-actual-count"></span>
				</div>
			</div>
	    	</div>
            </div>
        </div>
    </div>
</body>
</html>